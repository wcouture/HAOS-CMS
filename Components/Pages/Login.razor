@page "/login"
@using Microsoft.AspNetCore.Components.Server.ProtectedBrowserStorage

<PageTitle>Login</PageTitle>

<div class="login-page">
    <h1>CMS Login</h1>
    <p class="error-message">@errorMessage</p>

    <div>
        <form class="login-form" @formname="loginForm" @onsubmit="OnLogin" method="post">
            <div class="form-group">
                <label for="username">Username</label>
                <input type="text" name="username" id="username" @bind-value="UserLogin!.Username" />
            </div>
            <div class="form-group">
                <label for="password">Password</label>
                <input type="password" name="password" id="password" @bind-value="UserLogin!.Password"/>
            </div>
            <div class="form-group">
                <button type="submit">Login</button>
            </div>
        </form>
    </div>

</div>

@code {
    public class LoginModel {
        public string? Username {get; set;}
        public string? Password {get; set;}
    }

    [Inject]
    public required ProtectedSessionStorage sessionStorage {get; set;}
    [Inject]
    public required NavigationManager Navigation {get; set;}


    private string? errorMessage {get; set;}

    [SupplyParameterFromForm]
    public LoginModel? UserLogin {get; set;} = new();

    private async Task OnLogin() {
        errorMessage = "";
        if (UserLogin?.Username == "admin" && UserLogin?.Password == "admin") {
            await sessionStorage.SetAsync("user", "admin");
            Navigation.NavigateTo("/");
        }
        else {
            errorMessage = "Invalid username or password";
        }
    }
}
